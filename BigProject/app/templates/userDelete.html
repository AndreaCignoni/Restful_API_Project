<!DOCTYPE html>
<html>
<head>
    <title>Delete User Profile</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
</head>
<body>
    <h1>Delete User Profile</h1>
    <p>Are you sure you want to delete this user profile?</p>
    
    <button id="deleteButton" type="button">Delete</button>
    
    <div id="message" style="display: none;"></div>

    <script>
        // Function to get the user ID from the URL path
        function getUserIdFromUrl() {
            // Get the pathname of the URL
            var path = window.location.pathname;
            // Match the user ID from the pathname
            var match = path.match(/\/users\/(\d+)\/profile\/delete/);
            if (match) {
                return match[1]; // Return the matched user ID
            } else {
                return null; // Return null if user ID is not found in URL
            }
        }

        // Function to delete user profile
        function deleteUser(userId) {
            // Send a delete request to the server
            fetch('/users/' + userId + '/profile/delete', {
                method: 'DELETE'
            })
            .then(response => {
                if (response.ok) {
                    // Reload the page to reflect changes
                    window.location.reload();
                } else {
                    throw new Error('Failed to delete user: ' + response.statusText);
                }
            })
            .catch(error => {
                console.error('Delete user error:', error.message);
                document.getElementById('message').innerHTML = 'Error deleting user profile: ' + error.message;
                document.getElementById('message').style.display = 'block';
            });
        }

        // Attach click event listener to the delete button
        document.getElementById('deleteButton').addEventListener('click', function() {
            if (confirm('Are you sure you want to delete this user profile?')) {
                var userId = getUserIdFromUrl();
                if (userId) {
                    deleteUser(userId);
                } else {
                    console.error('User ID not found in URL.');
                    document.getElementById('message').innerHTML = 'User ID not found in URL.';
                    document.getElementById('message').style.display = 'block';
                }
            }
        });
    </script>
</body>
</html>